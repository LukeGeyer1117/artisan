{% extends 'merch_base.html' %}
{% load static %}

{% block title %}Merchant Dashboard{% endblock %}

{% block extra_head %}
  <link rel="stylesheet" href="{% static 'merchant/styles/settings.css' %}">
  <style>
    /* Basic tab styling */
    .tabs {
      display: flex;
      border-bottom: 2px solid #ccc;
      margin-bottom: 1rem;
    }
    .tab-btn {
      background: none;
      border: none;
      padding: 0.75rem 1.25rem;
      cursor: pointer;
      font-weight: bold;
      border-bottom: 3px solid transparent;
    }
    .tab-btn.active {
      border-bottom-color: var(--accent-color, #6c63ff);
      color: var(--accent-color, #6c63ff);
    }
    .tab-content {
      display: none;
    }
    .tab-content.active {
      display: block;
    }
  </style>
{% endblock %}

{% block content %}
  {% block nav %}
      {% include 'client/components/merchant/merch-nav/nav.html' with slug=artisan.slug %}
  {% endblock nav %}

  <main class="dashboard-main">
    {% block side-links %}
      {% include 'client/components/merchant/side-links/side-links.html' with slug=artisan.slug %}
    {% endblock side-links %}

    <div class="container">
      <h1>Settings</h1>

      <!-- Tabs -->
      <div class="tabs">
        <button class="tab-btn active" data-tab="design">Design</button>
        <button class="tab-btn" data-tab="account">Account</button>
        <button class="tab-btn" data-tab="text">Text Content</button>
        <button class="tab-btn" data-tab="shop">Shop</button>
      </div>

      <!-- Design Tab -->
      <div id="design" class="tab-content active">
        <section class="color-settings">
          <h2>Theme Settings</h2>
          <div class="color-controls">
            <div class="color-group">
              <label for="textColor">Text Color</label>
              <input type="color" id="textColor" name="textColor">
            </div>
            <div class="color-group">
              <label for="backgroundColor">Background Color</label>
              <input type="color" id="backgroundColor" name="backgroundColor">
            </div>
            <div class="color-group">
              <label for="accentColor">Accent Color</label>
              <input type="color" id="accentColor" name="accentColor">
            </div>
            <div class="color-group">
              <label for="linkHoverColor">Link Hover Color</label>
              <input type="color" id="linkHoverColor" name="linkHoverColor">
            </div>
            <p>See <a href="https://elementor.com/blog/color-theory-web-design/">here</a> for best practices when picking your colors.</p>
          </div>
        </section>

        <section class="logo-upload">
          <h2>Logo Image</h2>
          <img src="" alt="" class="settings-image" id="currentLogoImage">
          <div class="upload-group">
            <label for="logoUpload">Upload Logo</label>
            <input type="file" id="logoUpload" name="logoUpload" accept="image/*">
          </div>
        </section>

        <section class="hero-upload">
          <h2>Hero Image</h2>
          <img src="" alt="" class="settings-image" id="currentHeroImage">
          <div class="upload-group">
            <label for="heroUpload">Upload Hero Image</label>
            <input type="file" id="heroUpload" name="heroUpload" accept="image/*">
          </div>
        </section>

        <button type="button" class="save-button" id="save-theme-images-btn">Save Settings</button>
      </div>

      <!-- Account Settings Tab -->
      <div id="account" class="tab-content">
        <h2>Account Settings</h2>

        <div class="account-settings-container">
          <!-- Full Name section -->
          <div class="account-section">
            <h3>Full Name</h3>
            <p class="account-value" id="merchant-name">Full Name</p>
          </div>

          <!-- Email & Phone Section (row on large screens, column on small screens) -->
          <div class="account-section-row">
            <!-- Email Section -->
            <div class="account-section">
              <h3>Primary Email Address</h3>
              <p class="account-value" id="merchant-email">merchant@example.com</p>
              <span class="action-link" onclick="window.location.href='/update-email/'">change email address</span>
            </div>

            <!-- Phone Section -->
            <div class="account-section">
              <h3>Phone Number</h3>
              <p class="account-value" id="merchant-phone">(555) 123-4567</p>
              <span class="action-link" onclick="window.location.href='/update-phone/'">change phone number</span>
            </div>
          </div>

          <!-- Username & Password Section (row on large screens, column on small screens) -->
          <div class="account-section-row">
            <!-- Username Section -->
            <div class="account-section">
              <h3>Username</h3>
              <p class="account-value" id="merchant-username">merchant_user</p>
            </div>

            <!-- Password Section -->
            <div class="account-section">
              <h3>Password</h3>
              <p class="account-value" id="merchant-password">********</p>
              <span class="action-link" onclick="window.location.href='/reset-password/'">reset password</span>
            </div>
          </div>

        </div>
      </div>


      <!-- Text Content Tab -->
      <div id="text" class="tab-content">
        <h2>Text Content Settings</h2>
        <p>Forms for editing hero text, about section, etc.</p>
        
        <div class="text-content-input-section">
          <label for="hero-sentence-draw">Hero Sentence Draw</label>
          <input type="text" maxlength="50" id="hero-sentence-draw">
        </div>

        <div class="text-content-input-section">
          <label for="hero-header-draw">Hero Header Draw</label>
          <input type="text" maxlength="25" id="hero-header-draw">
        </div>

        <button class="save-button" id="submit-text-change">Submit Changes</button>
      </div>

      <!-- Shop Settings Tab -->
      <div id="shop" class="tab-content">
      <h2>Shop Settings</h2>
      <p>Config settings for your shop.</p>
      
      <div class="shop-input-section">
        <label for="shop-name">Shop Name</label>
        <input type="text" maxlength="50" id="shop-name">
        <div class="field-tip">This is how your shop will appear to customers. Choose something memorable and professional.</div>
      </div>

      <div class="shop-input-section">
        <label for="shop-description">Shop Description</label>
        <textarea maxlength="500" id="shop-description" rows="4"></textarea>
        <div class="field-tip">Tell customers what makes your shop special. This appears prominently on your shop page.</div>
      </div>

      <div class="shop-input-section">
        <label for="accepting-custom-orders">
          <input type="checkbox" id="accepting-custom-orders">
          Accept Custom Orders
        </label>
        <div class="field-tip important">When enabled, customers can request custom work beyond your listed products. Consider your capacity carefully.</div>
      </div>

      <div class="shop-input-section">
        <label for="max-active-orders">Maximum Active Orders</label>
        <input type="number" min="1" max="100" id="max-active-orders">
        <div class="field-tip important">This prevents you from getting overwhelmed. Once reached, customers won't be able to place new orders until you complete some.</div>
      </div>

      <div class="shop-input-section">
        <label for="processing-time">Standard Processing Time (days)</label>
        <input type="number" min="1" max="365" id="processing-time">
        <div class="field-tip">How long it typically takes you to create and ship an order. Be realistic - customers appreciate accurate timelines.</div>
      </div>

      <div class="shop-input-section">
        <label for="shop-location">Shop Location</label>
        <input type="text" maxlength="100" id="shop-location" placeholder="City, State/Country">
        <div class="field-tip">Helps customers understand shipping times and costs. You don't need to be overly specific.</div>
      </div>

      <div class="shop-input-section">
        <label for="currency">Currency</label>
        <select id="currency">
          <option value="USD">USD ($)</option>
          <option value="EUR">EUR (€)</option>
          <option value="GBP">GBP (£)</option>
          <option value="CAD">CAD ($)</option>
          <option value="AUD">AUD ($)</option>
        </select>
        <div class="field-tip">All your product prices will be displayed in this currency. Choose what's most convenient for your customers.</div>
      </div>

      <div class="shop-input-section">
        <label for="shop-status">Shop Status</label>
        <select id="shop-status">
          <option value="active">Active</option>
          <option value="vacation">Vacation Mode</option>
          <option value="maintenance">Maintenance</option>
        </select>
        <div class="field-tip important">Don't forget to switch back to "Active" after vacation! Customers can't order when your shop is inactive.</div>
      </div>

      <div class="shop-input-section">
        <label for="vacation-message">Vacation/Status Message</label>
        <textarea maxlength="200" id="vacation-message" rows="3" placeholder="Optional message for customers when shop is not active"></textarea>
        <div class="field-tip">Let customers know when you'll be back or why your shop is temporarily closed.</div>
      </div>

      <div class="shop-input-section">
        <label for="minimum-order">Minimum Order Amount</label>
        <input type="number" min="0" step="0.01" id="minimum-order">
        <div class="field-tip">Leave at 0 for no minimum. Useful if you want to encourage larger orders or cover payment processing fees.</div>
      </div>

      <div class="shop-input-section">
        <label for="shipping-policy">Shipping Policy</label>
        <textarea maxlength="1000" id="shipping-policy" rows="4" placeholder="Describe your shipping methods, costs, and timelines"></textarea>
        <div class="field-tip important">Be clear about shipping costs and who pays for them. This prevents confusion and disputes later.</div>
      </div>

      <div class="shop-input-section">
        <label for="return-policy">Return/Exchange Policy</label>
        <textarea maxlength="1000" id="return-policy" rows="4" placeholder="Describe your return and exchange policies"></textarea>
        <div class="field-tip important">A clear return policy builds customer trust. Consider what works for your type of products (especially custom items).</div>
      </div>

      <button class="save-button" id="submit-shop-changes">Submit Changes</button>
      </div>

    </div>
  </main>
{% endblock %}

{% block extra_scripts %}
  <script>
    const window_location = 'Settings';
    const active_URL = "/media/icons/active/settings_purple.svg";

    document.addEventListener("DOMContentLoaded", () => {
      const tabButtons = document.querySelectorAll(".tab-btn");
      const tabContents = document.querySelectorAll(".tab-content");

      // Load saved tab from localStorage
      const savedTab = localStorage.getItem("merchantSettingsTab");
      if (savedTab) {
        // Deactivate all
        tabButtons.forEach(b => b.classList.remove("active"));
        tabContents.forEach(c => c.classList.remove("active"));

        // Activate saved
        document.querySelector(`.tab-btn[data-tab="${savedTab}"]`)?.classList.add("active");
        document.getElementById(savedTab)?.classList.add("active");
      }

      tabButtons.forEach(btn => {
        btn.addEventListener("click", () => {
          // Remove active classes
          tabButtons.forEach(b => b.classList.remove("active"));
          tabContents.forEach(c => c.classList.remove("active"));

          // Activate clicked tab
          btn.classList.add("active");
          document.getElementById(btn.dataset.tab).classList.add("active");

          // Save the selected tab
          localStorage.setItem("merchantSettingsTab", btn.dataset.tab);
        });
      });
    });
  </script>
  <script type="module" src="{% static 'merchant/scripts/common.js' %}"></script>
  <script type="module" src="{% static 'merchant/scripts/theme_settings.js' %}"></script>
  <script type="module" src="{% static 'merchant/scripts/account_settings.js' %}"></script>
  <script type="module" src="{% static 'merchant/scripts/text_settings.js' %}"></script>
  <script type="module" src="{% static 'merchant/scripts/shop_settings.js' %}"></script>
{% endblock %}
